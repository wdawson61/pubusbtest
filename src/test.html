<head>
    <meta charset="utf-8" />
    <title>Add a raster tile source</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    </style>
    </head>
    <body onload="initBingMaps()">
    <div id="map"></div>
    <script>
        var map;
        
        var BingMapsKey = 'AsFIUUPStmlNDBZNkVXi0j6iJCYl27xdQ3W4NkImqgEtGm2Gc0BQOcfH6DpNWqEV';
        
        var BingMapsImagerySet = 'AerialWithLabelsOnDemand'; //Alternatively, use 'AerialWithLabelsOnDemand' if you also want labels on the map.
        
        var BingMapsImageryMetadataUrl = `https://dev.virtualearth.net/REST/V1/Imagery/Metadata/${BingMapsImagerySet}?output=json&include=ImageryProviders&key=${BingMapsKey}`;
    
        
        function initBingMaps() {
            
            fetch(BingMapsImageryMetadataUrl).then(r => r.json()).then(r => {
                
                var tileInfo = r.resourceSets[0].resources[0];
                
                //Bing Maps supports subdoamins which can make tile loading faster. Create a tile URL for each subdomain. 
                var tileUrls = [];
                
                tileInfo.imageUrlSubdomains.forEach(sub => {
                    tileUrls.push(tileInfo.imageUrl.replace('{subdomain}', sub));
                });
                
                //Use the image provider info to create attributions.
                var attributions = tileInfo.imageryProviders.map(p => {
                    return p.attribution;
                }).join(', ');
            
                //Create a style using a raster layer for the Bing Maps tiles.
                var style = {
                    'version': 8,
                    'sources': {
                        'bing-maps-raster-tiles': {
                            'type': 'raster',
                            'tiles': tileUrls,
                            'tileSize': tileInfo.imageWidth,
                            'attribution': attributions,
                            
                            //Offset set min/max zooms by one as Bign Maps is designed are 256 size tiles, while MapLibre is designed for 512 tiles.
                            'minzoom': 1,
                            'maxzoom': 20
                        }
                    },
                    'layers': [
                        {
                            'id': 'bing-maps-tiles',
                            'type': 'raster',
                            'source': 'bing-maps-raster-tiles',
                            'minzoom': 0,
                            'maxzoom': 23   //Let the imagery be overscaled to support deeper zoom levels.
                        }
                    ]
                };
                
                //If you want to add terrian, you can either append it onto the stlye like this, or add it inline above.
                
                //Add the source
                /*
                style.sources.terrainSource = {
                    type: 'raster-dem',
                    url: 'https://demotiles.maplibre.org/terrain-tiles/tiles.json',
                    tileSize: 256
                };
                
                style.terrain = {
                    source: 'terrainSource',
                    exaggeration: 1
                };
                */
                //Load MapLibre with this style.
                loadMap(style);
            });
            
        }
        
        function loadMap(baseMapsStyle) {
            map = new maplibregl.Map({
                container: 'map', // container id
                style: baseMapsStyle,
                zoom: 18,
                center: [-75.2081819, 42.52646784],
                pitch: 0,
            });
        
        }
    </script>
    
    </body>
    </html>